<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Acompanhar Pedido</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; background: #f5f5f5; }
    #map { height: 450px; width: 100%; margin-top: 20px; border-radius: 10px; }
    #status { font-size: 18px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>üçî Acompanhar Pedido</h2>
  <p>Veja a localiza√ß√£o da sua entrega em tempo real.</p>
  <div id="status">‚è≥ Aguardando rastreamento...</div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const SHEET_URL = "https://api.sheetbest.com/sheets/3198fc28-4ca0-4fde-86b1-cb1791fbe8d3";
    let map, marker;

    async function buscarLocalizacao() {
      const response = await fetch(SHEET_URL);
      const data = await response.json();
      if (data.length === 0) return;

      const ultima = data[data.length - 1];
      const status = ultima.status;
      const lat = parseFloat(ultima.latitude);
      const lon = parseFloat(ultima.longitude);

      const statusDiv = document.getElementById("status");

      if (status === "ativo" && !isNaN(lat) && !isNaN(lon)) {
        statusDiv.textContent = "üü¢ Entrega em andamento...";
        if (!map) {
          map = L.map('map').setView([lat, lon], 16);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
          }).addTo(map);
          marker = L.marker([lat, lon]).addTo(map).bindPopup("Entregador est√° aqui!");
        } else {
          marker.setLatLng([lat, lon]);
          map.setView([lat, lon], 16);
        }
      } else {
        statusDiv.textContent = "üî¥ Rastreamento ainda n√£o liberado.";
      }
    }

    // Atualiza a cada 5 segundos
    setInterval(buscarLocalizacao, 5000);
  </script>
</body>
</html>
